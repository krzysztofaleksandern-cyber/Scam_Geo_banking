FROM python:3.11-slim

RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential curl git ca-certificates \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app
ENV PIP_NO_CACHE_DIR=1 PYTHONDONTWRITEBYTECODE=1

COPY pyproject.toml requirements.txt ./
RUN pip install --upgrade pip && \
    if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

COPY src ./src
RUN pip install -e .

RUN mkdir -p /data/in /data/out /data/tmp /configs
VOLUME ["/data","/configs"]

ENTRYPOINT ["python","-m","scamgeo.cli.app","run","-i","/data/in/sample_channels.txt","-o","/data/out","--zip","/data/out/evidence.zip"]
